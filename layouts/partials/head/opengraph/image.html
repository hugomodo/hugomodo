{{ with .Params.images }}
  {{ range first 6 . }}
    {{ $path := . }}

    {{ $path_arr := split $path "." }}
    {{ $index := sub (len $path_arr) 1 }}
    {{ $ext := index $path_arr $index }}

    {{ $ogimage := ($.Site.GetPage "section" "uploads").Resources.GetMatch (strings.TrimPrefix "/uploads/" $path ) }}

    {{ if ne $ext "svg" }}
      {{ if gt $ogimage.Width 1200 }}
        {{ $.Scratch.Set "image" ($ogimage.Fill "1200x630") }}
      {{ else if gt $ogimage.Width 800 }}
        {{ $.Scratch.Set "image" ($ogimage.Fill "800x420") }}
      {{ else if gt $ogimage.Width 600 }}
        {{ $.Scratch.Set "image" ($ogimage.Fill "600x320") }}
      {{ else }}
        {{ $.Scratch.Set "image" ($ogimage) }}
      {{ end }}
      {{ $image := $.Scratch.Get "image" }}
      <meta property="og:image" content="{{ $image.Permalink }}" />
      <meta property="og:image:width" content="{{ $image.Width }}" />
      <meta property="og:image:height" content="{{ $image.Height }}" />
      {{ $.Scratch.Set "image_found" "true" }}
    {{ end }}
  {{ end }}
{{ end }}

{{ $image_found := $.Scratch.Get "image_found" }}

{{ if ne $image_found "true" }}
  {{ with.Site.Params.images }}
    {{ range first 6 . }}
      {{ $path := . }}

      {{ $path_arr := split $path "." }}
      {{ $index := sub (len $path_arr) 1 }}
      {{ $ext := index $path_arr $index }}

      {{ $ogimage := ($.Site.GetPage "section" "uploads").Resources.GetMatch (strings.TrimPrefix "/uploads/" $path ) }}

      {{ if ne $ext "svg" }}
        {{ if gt $ogimage.Width 1200 }}
          {{ $.Scratch.Set "image" ($ogimage.Fill "1200x640") }}
        {{ else if gt $ogimage.Width 800 }}
          {{ $.Scratch.Set "image" ($ogimage.Fill "800x420") }}
        {{ else if gt $ogimage.Width 600 }}
          {{ $.Scratch.Set "image" ($ogimage.Fill "600x320") }}
        {{ else }}
          {{ $.Scratch.Set "image" ($ogimage) }}
        {{ end }}
        {{ $image := $.Scratch.Get "image" }}
        <meta property="og:image" content="{{ $image.Permalink }}" />
        <meta property="og:image:width" content="{{ $image.Width }}" />
        <meta property="og:image:height" content="{{ $image.Height }}" />
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}
